<Window x:Class="auto_chinhdo.Views.ScriptEditorWindow"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        Title="Script Editor - Táº¡o Ká»‹ch Báº£n Auto" 
        Height="700" Width="1100"
        Background="#F5F5F5"
        WindowStartupLocation="CenterOwner">

    <Window.Resources>
        <!-- Card Style -->
        <Style TargetType="Border" x:Key="CardStyle">
            <Setter Property="BorderBrush" Value="#E0E0E0"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="8"/>
            <Setter Property="Padding" Value="12"/>
            <Setter Property="Background" Value="White"/>
            <Setter Property="Effect">
                <Setter.Value>
                    <DropShadowEffect ShadowDepth="1" Color="#AAAAAA" Opacity="0.2" BlurRadius="4"/>
                </Setter.Value>
            </Setter>
        </Style>
        
        <!-- Button Style -->
        <Style TargetType="Button" x:Key="PrimaryBtn">
            <Setter Property="Background" Value="#007ACC"/>
            <Setter Property="Foreground" Value="White"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Padding" Value="12,6"/>
            <Setter Property="Margin" Value="4,0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border Background="{TemplateBinding Background}" CornerRadius="5" Padding="{TemplateBinding Padding}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#005A99"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        
        <Style TargetType="Button" x:Key="RecordBtn" BasedOn="{StaticResource PrimaryBtn}">
            <Setter Property="Background" Value="#D32F2F"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#B71C1C"/>
                </Trigger>
            </Style.Triggers>
        </Style>

        <Style TargetType="Button" x:Key="SuccessBtn" BasedOn="{StaticResource PrimaryBtn}">
            <Setter Property="Background" Value="#4CAF50"/>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#388E3C"/>
                </Trigger>
            </Style.Triggers>
        </Style>
    </Window.Resources>

    <Grid Margin="16">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="12"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="12"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- HEADER: Script Info & Toolbar -->
        <Border Grid.Row="0" Style="{StaticResource CardStyle}">
            <DockPanel>
                <!-- Script Name -->
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Left" VerticalAlignment="Center">
                    <TextBlock Text="ðŸ“œ TÃªn ká»‹ch báº£n:" FontWeight="Bold" VerticalAlignment="Center" Margin="0,0,8,0"/>
                    <TextBox x:Name="ScriptNameBox" Width="200" Text="New Script" FontSize="14"/>
                </StackPanel>

                <!-- Toolbar -->
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" HorizontalAlignment="Right">
                    <Button x:Name="BtnRecord" Content="ðŸ”´ Record" Style="{StaticResource RecordBtn}" Click="BtnRecord_Click"/>
                    <Button x:Name="BtnAddStep" Content="âž• ThÃªm bÆ°á»›c" Style="{StaticResource PrimaryBtn}" Click="BtnAddStep_Click"/>
                    <Button x:Name="BtnDeleteStep" Content="ðŸ—‘ï¸ XÃ³a" Style="{StaticResource PrimaryBtn}" Click="BtnDeleteStep_Click"/>
                    <Border Width="1" Background="#DDD" Margin="8,0"/>
                    <Button x:Name="BtnMoveUp" Content="â¬†ï¸" Style="{StaticResource PrimaryBtn}" Click="BtnMoveUp_Click" ToolTip="Di chuyá»ƒn lÃªn"/>
                    <Button x:Name="BtnMoveDown" Content="â¬‡ï¸" Style="{StaticResource PrimaryBtn}" Click="BtnMoveDown_Click" ToolTip="Di chuyá»ƒn xuá»‘ng"/>
                </StackPanel>
            </DockPanel>
        </Border>

        <!-- MAIN CONTENT -->
        <Grid Grid.Row="2">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="*" MinWidth="350"/>
                <ColumnDefinition Width="12"/>
                <ColumnDefinition Width="350"/>
            </Grid.ColumnDefinitions>

            <!-- LEFT: Steps List -->
            <Border Grid.Column="0" Style="{StaticResource CardStyle}">
                <DockPanel>
                    <TextBlock DockPanel.Dock="Top" Text="ðŸ“‹ Danh sÃ¡ch cÃ¡c bÆ°á»›c" FontSize="14" FontWeight="Bold" Margin="0,0,0,8"/>
                    <ListView x:Name="StepsListView" 
                              SelectionChanged="StepsListView_SelectionChanged"
                              AllowDrop="True"
                              PreviewMouseLeftButtonDown="StepsListView_PreviewMouseLeftButtonDown"
                              Drop="StepsListView_Drop">
                        <ListView.View>
                            <GridView>
                                <GridViewColumn Header="#" Width="40" DisplayMemberBinding="{Binding StepNumber}"/>
                                <GridViewColumn Header="MÃ´ táº£" Width="180" DisplayMemberBinding="{Binding Description}"/>
                                <GridViewColumn Header="Action" Width="70" DisplayMemberBinding="{Binding Action}"/>
                                <GridViewColumn Header="OnFail" Width="100" DisplayMemberBinding="{Binding OnFail}"/>
                                <GridViewColumn Header="Timeout" Width="70" DisplayMemberBinding="{Binding TimeoutMs}"/>
                            </GridView>
                        </ListView.View>
                    </ListView>
                </DockPanel>
            </Border>

            <!-- RIGHT: Step Details Editor -->
            <Border Grid.Column="2" Style="{StaticResource CardStyle}">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel x:Name="StepDetailsPanel" IsEnabled="False">
                        <TextBlock Text="âš™ï¸ Chi tiáº¿t bÆ°á»›c" FontSize="14" FontWeight="Bold" Margin="0,0,0,12"/>

                        <!-- Description -->
                        <TextBlock Text="MÃ´ táº£:" FontWeight="SemiBold"/>
                        <TextBox x:Name="TxtDescription" Margin="0,4,0,12" TextChanged="StepDetail_Changed"/>

                        <!-- Template Preview -->
                        <TextBlock Text="áº¢nh máº«u (Template):" FontWeight="SemiBold"/>
                        <Border BorderBrush="#CCC" BorderThickness="1" Height="80" Margin="0,4,0,4" Background="#F9F9F9">
                            <Image x:Name="TemplatePreview" Stretch="Uniform"/>
                        </Border>
                        <Button Content="ðŸ“· Chá»n/Cáº¯t áº£nh máº«u..." Style="{StaticResource PrimaryBtn}" 
                                HorizontalAlignment="Left" Click="BtnSelectTemplate_Click"/>

                        <!-- Action Type -->
                        <TextBlock Text="HÃ nh Ä‘á»™ng:" FontWeight="SemiBold" Margin="0,12,0,0"/>
                        <ComboBox x:Name="CmbAction" Margin="0,4,0,12" SelectionChanged="CmbAction_SelectionChanged">
                            <ComboBoxItem Content="Tap" Tag="Tap"/>
                            <ComboBoxItem Content="TapText (OCR)" Tag="TapText"/>
                            <ComboBoxItem Content="DoubleTap" Tag="DoubleTap"/>
                            <ComboBoxItem Content="Wait" Tag="Wait"/>
                            <ComboBoxItem Content="Swipe" Tag="Swipe"/>
                        </ComboBox>

                        <!-- OCR Panel (visible when TapText) -->
                        <StackPanel x:Name="OcrPanel" Visibility="Collapsed">
                            <TextBlock Text="ðŸ”¤ Text cáº§n tÃ¬m (OCR):" FontWeight="SemiBold" Foreground="#9C27B0"/>
                            <TextBox x:Name="TxtTextToFind" Margin="0,4,0,8" TextChanged="StepDetail_Changed"
                                     ToolTip="Nháº­p text báº¡n muá»‘n tÃ¬m trÃªn mÃ n hÃ¬nh game"
                                     InputMethod.IsInputMethodEnabled="True"
                                     xml:lang="vi-VN"
                                     AcceptsReturn="False"/>
                            <CheckBox x:Name="ChkExactMatch" Content="Match chÃ­nh xÃ¡c (phÃ¢n biá»‡t hoa thÆ°á»ng)" 
                                      Margin="0,0,0,12" Checked="StepDetail_Changed" Unchecked="StepDetail_Changed"/>
                        </StackPanel>

                        <!-- Timeout -->
                        <TextBlock Text="Timeout (ms):" FontWeight="SemiBold"/>
                        <TextBox x:Name="TxtTimeout" Margin="0,4,0,12" Text="5000" TextChanged="StepDetail_Changed"/>

                        <!-- Delay After -->
                        <TextBlock Text="Delay sau action (ms):" FontWeight="SemiBold"/>
                        <TextBox x:Name="TxtDelayAfter" Margin="0,4,0,12" Text="1000" TextChanged="StepDetail_Changed"/>

                        <!-- On Fail Behavior -->
                        <TextBlock Text="Khi khÃ´ng tÃ¬m tháº¥y áº£nh:" FontWeight="SemiBold" Foreground="#D32F2F"/>
                        <ComboBox x:Name="CmbOnFail" Margin="0,4,0,8" SelectionChanged="StepDetail_Changed">
                            <ComboBoxItem Content="Stop - Dá»«ng vÃ  log lá»—i"/>
                            <ComboBoxItem Content="RetryFromStart - Quay vá» bÆ°á»›c 1"/>
                            <ComboBoxItem Content="RetryCurrentStep - Thá»­ láº¡i bÆ°á»›c nÃ y"/>
                            <ComboBoxItem Content="SkipToNext - Bá» qua, sang bÆ°á»›c tiáº¿p"/>
                        </ComboBox>

                        <!-- Retry Count (visible when RetryCurrentStep) -->
                        <StackPanel x:Name="RetryPanel" Visibility="Collapsed">
                            <TextBlock Text="Sá»‘ láº§n thá»­ láº¡i:" FontWeight="SemiBold"/>
                            <TextBox x:Name="TxtRetryCount" Margin="0,4,0,12" Text="3" TextChanged="StepDetail_Changed"/>
                        </StackPanel>
                    </StackPanel>
                </ScrollViewer>
            </Border>
        </Grid>

        <!-- FOOTER: Save/Cancel -->
        <Border Grid.Row="4" Style="{StaticResource CardStyle}">
            <DockPanel>
                <StackPanel Orientation="Horizontal" DockPanel.Dock="Right" HorizontalAlignment="Right">
                    <Button Content="ðŸ’¾ LÆ°u ká»‹ch báº£n" Style="{StaticResource SuccessBtn}" Click="BtnSave_Click"/>
                    <Button Content="Há»§y" Style="{StaticResource PrimaryBtn}" Click="BtnCancel_Click"/>
                </StackPanel>
                <TextBlock x:Name="StatusText" VerticalAlignment="Center" Foreground="#666" 
                           Text="Chá»n má»™t bÆ°á»›c Ä‘á»ƒ chá»‰nh sá»­a hoáº·c báº¥m Record Ä‘á»ƒ thÃªm bÆ°á»›c má»›i"/>
            </DockPanel>
        </Border>
    </Grid>
</Window>
